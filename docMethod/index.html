<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

<body class="text-center">
    <div class="row">
        <div class="col">
        </div>
        <div class="col">
            <div class="form-signin">
                <form id="relevantInformation">
                    <div class="form-group">
                        <label for="firstName">Vorname</label>
                        <input type="text" class="form-control" id="firstName" placeholder="Vorname" name="firstName"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="Name">Nachname</label>
                        <input type="text" class="form-control" id="Name" name="Name" placeholder="Name" required>
                    </div>
                    <div class="form-group required">
                        <label for="phone">Telefonnummer</label>
                        <input type="text" class="form-control" id="phone" name="phone" placeholder="071824666"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="birthday">Geburtstag</label>
                        <input type="date" id="birthday" name="birthday" required>
                    </div>
                    <div class="form-group">
                        <label for="maennlich">Geschlecht männlich?</label>
                        <input type="checkbox" class="form-control" id="maennlich" placeholder="true" name="maennlich">
                    </div>
                    <div class="form-group">
                        <label for="adress">Straße+Nr</label>
                        <input type="text" class="form-control" id="adress" name="adress"
                            placeholder="Stuttgarterstr. 12" required>
                    </div>
                    <div class="form-group required">
                        <label for="city">PLZ+Stadt</label>
                        <input type="text" class="form-control" id="city" name="city" placeholder="73642 Welzheim"
                            required>
                    </div>
                    <div class="form-group required">
                        <label for="exampleInputEmail">Email address</label>
                        <input type="email" class="form-control" id="exampleInputEmail" name="exampleInputEmail"
                            aria-describedby="emailHelp" placeholder="Enter email" required>
                    </div>
                    <div class="form-group required">
                        <label for="dateOfTest">TestDatum</label>
                        <input type="datetime-local" id="dateOfTest" name="dateOfTest" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
            <a href="/randomize.docx" download="randomize.docx">
                <button class="btn btn-primary" id="downloadButton" href="/randomize.docx">Download PCR!</button>
            </a>
        </div>
        <div class="col">
        </div>

    </div>
</body>

<!--
    Mandatory in IE 6, 7, 8 and 9.
    -->
<!--[if IE]>
        <script
            type="text/javascript"
            src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils-ie.js"
        ></script>
    <![endif]-->
<script>
    window.onload = function () {
        $("#downloadButton").prop('disabled', true);
    }

    $("form").submit(function (event) {
        $("#downloadButton").prop('disabled', true);
        event.preventDefault();
        var form = $('#relevantInformation');
        var method = form.attr('method');
        var url = form.attr('action') + 'plainjson/';
        var jsonData = {};
        $.each($(form).serializeArray(), function () {
            jsonData[this.name] = this.value;
        });
        generateDocument(jsonData);
    });

    async function generateDocument(data) {
        var settings = {
            "async": true,
            "crossDomain": true,
            "url": "http://localhost:3000/docRenderedWithQRCODE2",
            "method": "POST",
            "headers": {
                "content-type": "application/json",
                "cache-control": "no-cache"
            },
            "processData": false,
            "data": JSON.stringify(data)
        }

        $.ajax(settings).done(function (response) {
            $("#downloadButton").prop('disabled', false);
            return Promise.done;
        });
    }

    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }

    function saveBlob(blob, fileName) {

        var blobUrl = URL.createObjectURL([blob]);

        // create temp link element
        let link = document.createElement("a");
        link.download = filename;
        link.href = blobUrl;

        // use the link to invoke a download
        document.body.appendChild(link);
        link.click();

        // remove the link
        setTimeout(() => {
            link.remove();
            window.URL.revokeObjectURL(blobUrl);
            link = null;
        }, 0);
    };
</script>

</html>